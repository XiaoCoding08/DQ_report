import { defineStore } from 'pinia'
import { ref } from 'vue'

export const useReportStore = defineStore('report', () => {
    // ================= 状态 (State) =================

    // 1. 模板数据 (来自原 HTML templateCategories)
    const templates = ref([
        {
            name: "测井解释报告",
            list: [
                {
                    id: 'tpl_log_001',
                    title: '测井解释报告模板1',
                    create_time: '2026-01-20',
                    content: `# 地质勘测报告\n## 第一章 井况概查与地质背景\n### 1.1 基础井情\n### 1.2 区域地质背景与钻探目的\n## 第二章 测井资料采集与质量控制\n### 2.1 测井作业综述\n### 2.2 环境影响校正与质量评定\n## 第三章 地层划分与岩性矿物分析\n### 3.1 地层分层综述\n### 3.2 岩性电性特征描述\n## 第四章 储层参数计算模型与解释方法\n### 4.1 泥质含量计算\n### 4.2 孔隙度计算\n### 4.3 含油饱和度计算\n## 第五章 油气层综合解释成果\n### 5.1 典型层位详细评价\n### 5.2 解释成果汇总表\n## 第六章 结论与试油建议`
                },
                {
                    id: 'tpl_log_002',
                    title: '测井解释报告模板2',
                    create_time: '2026-01-20',
                    content: `# 报告模板

**单位：**
**时间：**

## 目 录
一、概况
二、测井内容及质量评定
三、测井解释参数
四、新技术应用情况
五、解释成果及分析
六、建议及要求
七、图、表目录
八、附带说明

## 一、概况

| 类别 | 项目/参数 | 内容 | 项目/参数 | 内容 |
| :--- | :--- | :--- | :--- | :--- |
| **钻井** | 井别 | | 井位 | |
| | 钻井目的 | | | |
| | 钻井队 | | 开钻时间 | |
| | 套管程序 | | 钻头程序 | |
| | 完钻时间 | | 完钻井深 | |
| | 钻开油层时间 | | 钻井液停止循环时间 | |
| **钻井液** | 密度 | | 粘度 | |
| | 失水量 | | pH 值 | |
| | 矿化度 | | 电阻率 | |
| | 样品来源 | | | |
| **测井** | 测井小队 | | 测井系列 | |
| | 测井时间 | | 测时井深 | |
| | 测量井段 | | 井底温度 | |

二、测井内容及质量评定
### 1. 测井曲线施工质量评价

| 序号 | 曲线名称 | 测量井段 (m) | 质量评比 | 深度比例 | 备注 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | | | | | |
| 2 | | | | | |
| ... | | | | | |
| **合格率** | | | | | |

**填写说明：**
1. 质量评比栏以合格、优质、不合格注明。
2. 备注栏注明质量不合格的原因。

### 2. 测井曲线应用质量评价

| 序号 | 曲线名称 | 测量井段 (m) | 质量评比 | 深度比例 | 备注 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | | | | | |
| 2 | | | | | |
| ... | | | | | |
| **合格率** | | | | |  |

**填写说明：**
1. 质量评比栏以合格、优质、不合格注明。
2. 备注栏注明质量不合格的原因。

## 三、测井解释参数

### 1. 处理程序及参数选取依据

### 2. 参数选取结果
**井段：**
| 成分/项 | UOIL | XOIL | UWAT | XWAT | SAND | SHAL |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **RHOB** | | | | | | |
| **NPHI** | | | | | | |
| **DT** | | | | | | |
| **RXO** | | | | | | |
| **RT** | | | | | | |
| **GR** | | | | | | |
## 四、新技术应用情况
填写说明：XXXX

## 五、解释成果及分析
### 1. 解释成果
### 2. 解释成果分析
#### 2.1 概述

#### 2.2 邻井试油情况
#### 2.3 分层讨论
## 六、建议及要求
## 七、图、表目录
| 序号 | 图（表）件名称 | 份数 |
| :--- | :--- | :--- |
| 1 | | 1 |
| 2 | | |
| ... | | |

## 八、附带说明
1. 处理程序及说明/处理解释参数符号说明
2. 成果图展示/简介
![图1-井位示意图](图占位)`
                }
            ]
        },
        {
            name: "工作总结模板",
            list: [
                {
                    id: 'tpl_work_weekly_summary',
                    title: '周工作总结',
                    create_time: '2026-01-20',
                    content: '# 月度绩效汇报\n## 关键指标达成\n本月完成率：\n| 指标 | 目标值 | 实际值 | 达成率 |\n|---|---|---|---|\n| 销售额 |  |  |  |\n| 客户数 |  |  |  |'
                }
            ]
        },
        {
            name: "民主生活会报告模板",
            list: [
                {
                    id: 'tpl_meeting_attach_2',
                    title: '附件模板2',
                    create_time: '2026-01-20',
                    content: `# 2024年度领导班子民主生活会
# 征求意见建议情况报告
## 按照院党委《关于认真开好2024年度党员领导干部民主生活会的通知》要求，结合民主生活会主题，重点围绕……等4个方面问题，广泛征求意见和建议，具体情况如下：
## 一、在带头严守政治纪律和政治规矩，维护党的团结统一。健全落实以学铸魂、以学增智、以学正风、以学促干长效机制，深刻领悟“两个确立”的决定性意义，坚决做到“两个维护”，自觉防止和反对个人主义、分散主义、自由主义、本位主义，自觉在思想上政治上行动上同以习近平同志为核心的党中央保持高度一致方面
（征求的意见建议）
## 二、在带头增强党性、严守纪律、砥砺作风。始终用党性原则修身律己，时刻以《条例》等党规党纪为标尺从严从实检身正已，把党的纪律内化为日用而不觉的言行准则，公正用权、依法用权、为民用权、廉洁用权，锲而不舍落实中央八项规定及其实施细则精神，自觉践行社会主义核心价值观方面
（征求的意见建议）
## 三、在带头在遵规守纪、清正廉洁前提下勇于担责、敢于创新。聚焦推动高质量发展，强化将改革进行到底的坚定决心和历史担当，以攻坚克难、迎难而上的政治勇气，直面矛盾问题不回避，铲除顽瘴痼疾不含糊，应对风险挑战不退缩，奋力打开改革发展新天地。树立和践行正确政绩观，坚决防范化解重点领域风险，坚决防范整治急功近利、好大喜功、寅吃卯粮甚至弄虚作假等行为，深化整治形式主义为基层减负，着力解决员工群众急难愁盼问题，走好新时代党的群众路线方面
（征求的意见建议）
## 四、在带头履行全面从严治党政治责任。坚持用改革精神和严的标准管党治党，坚持党性党风党纪一起抓、正风肃纪反腐相贯通，深入开展纪律教育，深化运用监督执纪“四种形态”，着力铲除腐败滋生的土壤和条件。树好选人用人风向标，认真落实“三个区分开来”，着力解决干部乱作为、不作为、不敢为、不善为问题。规范网络空间言行，引导党员干部在网络空间主动正确发声、敢于善于斗争方面
（征求的意见建议)`
                },
                {
                    id: 'tpl_meeting_attach_5',
                    title: '附件模板5',
                    create_time: '2026-01-20',
                    content: `# ×××（单位）领导班子
# 2024年度民主生活会对照检查材料
按照院党委《关于认真开好2024年度党员领导干部民主生活会的通知》和《油田党员领导干部民主生活会若干规定》要求，××领导班子聚焦民主生活会主题，认真组织学习研讨，广泛听取意见建议，深入开展谈心谈话，深刻对照检查剖析。现就领导班子对照检查情况报告如下：
## 一、领导班子政治思想作风建设情况
（重点聚焦民主生活会主题，围绕领导班子理论学习、政治素质、工作作风和担当作为等情况进行撰写，特别是要认真盘点总结党纪学习教育取得的成效及体会。此部分要简明扼要，用事实和数据说话，自行归纳，篇幅控制在一页半左右）
## 二、查摆存在的主要问题
（紧扣党纪学习教育目标任务，对照党的政治纪律、组织纪律、廉洁纪律、群众纪律、工作纪律、生活纪律的主旨要义和规定要求，深入检视剖析学习领会习近平总书记关于全面加强党的纪律建设的重要论述情况和学习贯彻《条例》情况，结合班子实际，重点从4个方面深刻查摆差距不足。同时，要将学习贯彻习近平新时代中国特色社会主义思想主题教育以来有关民主生活会尚未完成的整改问题，巡视巡察、审计发现问题，一并作为检视整改的问题。）
### （一）在带头严守政治纪律和政治规矩，维护党的团结统一方面
……
### （二）在带头增强党性、严守纪律、砥砺作风方面
……
### （三）在带头在遵规守纪、清正廉洁前提下勇于担责、敢于创新方面
……
### （四）在带头履行全面从严治党政治责任方面
……
（以上四方面内容，每个方面原则上查找不少于2项问题。）
### （五）在学习贯彻习近平新时代中国特色社会主义思想主题教育以来有关民主生活会尚未完成的整改问题方面（视情况，如有须进行查摆）
……
### （六）在本年度巡视巡察反馈问题方面
此部分统一写“无”。
（查摆问题要直奔主题，紧密结合单位实际，做到“三个摆进去”，切实把存在问题找准、找深、找全，不能搞形式、走过场、蒙混过关。每一个方面都要查找问题，不能以个人问题代替班子问题，不能以工作问题代替思想问题。不采用肯定成绩或说明主客观原因后再表述问题，类似于“虽然……但是……”的表述方式，九分成绩一分问题；原则上不用类似“还不够”“不够好”等类似程度词。）
## 三、产生问题的原因分析
（原因分析时要回应查摆出的问题，有针对性的进行分析；要突出党性分析，从政治、思想、能力、作风、纪律等方面深挖思想变化、问题形成的过程，不能用表象或具体问题作为产生问题的原因；要聚焦产生的问题进行分析，既不能“大而空”、避实就虚，也不能“小而碎”、避重就轻，要见筋见骨、抓住要害。）
……
## 四、反面典型案例剖析
### （一）典型案例基本情况
（选取近年来发生在本单位的至少1个违纪行为典型案例，特别是严重违纪违法的典型案例，举一反三进行剖析，以案说德、以案说纪、以案说法、以案说责。在案件的典型性上，重点要选取政治问题与经济问题交织、一把手权力失控、顶风违纪、靠企吃企、靠油吃油等方面典型案例。如果本单位没有典型案例的，可结合本系统、本领域、本单位、本部门的实际，从集团公司通报的违纪违法案例中选取。）
……
注：此部分根据提供的附件7相关素材撰写。
### （二）对照查摆问题
（围绕典型案例暴露出的突出问题，对照检视本单位在思想认识、管党治党责任、制度机制等方面的差距不足。）
……
### （三）检视剖析原因
（围绕查摆的问题，从政治意识、规矩意识、责任意识、担当意识等方面进行党性分析。）
……
## 五、整改措施及努力方向
### （一）
### （二）
### （三）
……
（要坚持以问题为导向，针对查摆出来的问题逐一明确整改方向、制定整改措施，措施要与查摆问题呼应，要包含反面典型案例检视问题的整改，实实在在、具体明确、切实可行、操作性强，便于实施整改。）

说明：对照检查材料要紧扣主题，由党组织负责人主持起草并召开专门会议研讨领导班子对照检查材料。`
                }
            ]
        }
    ])

    // 2. 报告数据 (来自原 HTML reports)
    const reports = ref([
        {
            id: 'rpt_001',
            title: '测井解释报告',
            create_time: '2026-01-20',
            sources: ['L92_well_logging_data.pdf', 'L92_geological_survey.docx'],
            content: `# 测井解释报告

**单位：** 某石油勘探开发研究院  
**时间：** 2026年1月20日

## 目 录
一、概况
二、测井内容及质量评定
三、测井解释参数
四、新技术应用情况
五、解释成果及分析
六、建议及要求
七、图、表目录
八、附带说明
## 一、概况
| 类别 | 项目/参数 | 内容 | 项目/参数 | 内容 |
| :--- | :--- | :--- | :--- | :--- |
| **钻井** | 井别 | 预探井 | 井位 | 冀中坳陷XX构造 |
| | 钻井目的 | 探明沙三段含油性 | | |
| | 钻井队 | 钻井二公司30502队 | 开钻时间 | 2026-01-15 |
| | 套管程序 | 9-5/8" @ 2005m | 钻头程序 | 8-1/2" (2005-3500m) |
| | 完钻时间 | 2026-01-18 | 完钻井深 | 3500.00 m |
| | 钻开油层时间 | 2026-01-18 | 钻井液停止循环时间 | 2026-01-18 04:00 |
| **钻井液** | 密度 | 1.18 g/cm³ | 粘度 | 45 s |
| | 失水量 | 4.5 ml | pH 值 | 9.0 |
| | 矿化度 | 6500 mg/L | 电阻率 | 1.2 Ω·m @ 25℃ |
| | 样品来源 | 循环罐出口 | | |
| **测井** | 测井小队 | 测井公司C201队 | 测井系列 | PEX+HRLA+CMR |
| | 测井时间 | 2026-01-19 | 测时井深 | 3498.00 m |
| | 测量井段 | 2005.00 - 3495.00 m | 井底温度 | 105.5 ℃ |

---

## 二、测井内容及质量评定

### 1. 测井曲线施工质量评价

| 序号 | 曲线名称 | 测量井段 (m) | 质量评比 | 深度比例 | 备注 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | GR (自然伽马) | 2005-3495 | 优质 | 1:200 | 曲线平滑，重复性好 |
| 2 | CAL (井径) | 2005-3495 | 合格 | 1:200 | 3100m处有局部井塌 |
| 3 | RT (深电阻率) | 2005-3495 | 优质 | 1:200 | 探测深度达标 |
| 4 | DEN/NEU/AC | 2005-3495 | 优质 | 1:200 | 三孔隙度匹配良好 |
| **合格率** | **100%** | | | | |

**填写说明：** 
1. 质量评比栏以合格、优质、不合格注明；
2. 备注栏注明质量不合格的原因。

### 2. 测井曲线应用质量评价

| 序号 | 曲线名称 | 测量井段 (m) | 质量评比 | 深度比例 | 备注 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | 标准化GR | 2005-3495 | 优质 | 1:200 | 已参考邻井均值校正 |
| 2 | 环境校正RT | 2005-3495 | 优质 | 1:200 | 已排除井筒影响 |
| **合格率** | **100%** | | | | |

**填写说明：** 
1. 质量评比栏以合格、优质、不合格注明；
2. 备注栏注明质量不合格的原因。
---

## 三、测井解释参数
### 1. 处理程序及参数选取依据
本次解释采用Forward 5.0处理平台。泥质含量（Vsh）由GR指数法计算；孔隙度（PHI）采用密度-中子交会法；含水饱和度（Sw）采用Archie公式。a取1.0，m取2.0，n取2.0。

### 2. 参数选取结果
**井段：2850.0 - 3200.0 m (沙三段)**
| 成分/项 | UOIL | XOIL | UWAT | XWAT | SAND | SHAL |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| **RHOB** | 0.85 | - | 1.05 | - | 2.65 | 2.55 |
| **NPHI** | 0.65 | - | 1.00 | - | -0.03 | 0.35 |
| **DT** | 600.0 | - | 620.0 | - | 180.0 | 320.0 |
| **RXO** | - | 1.20 | - | 0.85 | - | - |
| **RT** | - | 15.0 | - | 0.50 | - | - |
| **GR** | - | - | - | - | 15.0 | 120.0 |
## 四、新技术应用情况
本井应用了CMR磁共振成像测井技术。通过T2分布谱分析，有效区分了束缚水与自由流体。在2950m砂岩段，CMR计算的有效孔隙度明显低于总孔隙度，揭示了该层位微孔隙结构发达、含束缚水高的特征，为后续试油层位的选择提供了关键依据。
## 五、解释成果及分析
### 1. 解释成果
全井共划分综合解释层12层，累计厚度45.6m。其中：油层2层/8.5m，差油层3层/12.2m，水层7层/24.9m。
### 2. 解释成果分析
#### 2.1 概述
本井目标层段为沙三段中下部。测井显示该段整体呈细砂岩与泥岩频繁互层特征。储层孔隙度分布在12%~18%之间，渗透率中等。
#### 2.2 邻井试油情况
邻井XX-1井（位于本井北侧1.5km）在同层位2980-2995m段试油，日产原油15.2t，不含水。
#### 2.3 分层讨论
* 第5层 (2945.0-2952.5m)：电阻率从3.5Ω·m上升至12.0Ω·m，三孔隙度曲线显示明显的“气窗”特征（中子-密度挖掘效应），GR值较低（45API），综合解释为油层。
* 第8层 (3120.0-3135.0m)：电阻率较低（0.8-1.5Ω·m），声波时差高，CMR自由流体体积小，判定为水层。
## 六、建议及要求
1. 建议对 2945.0-2952.5m 井段进行常规试油，验证油气潜能。
2. 考虑到该区沙三段具有较强的非均质性，后续开发中需加强压力监测。
3. 建议补做岩心压汞实验，以进一步标定磁共振毛管压力曲线。
## 七、图、表目录

| 序号 | 图（表）件名称 | 份数 |
| :--- | :--- | :--- |
| 1 | 综合解释成果图 (1:200) | 1 |
| 2 | 磁共振T2分布成像图 | 1 |
| 3 | 测井解释成果汇总表 | 1 |
| 4 | 泥质含量与孔隙度交会图 | 1 |
| 5 |
| 6 |

---

## 八、附带说明
1. **处理解释参数符号说明：** RHOB-密度，NPHI-中子孔隙度，DT-声波时差，RT-深感应电阻率，UOIL-油相端点值。
2. **成果图展示：**

![图1-解释成果图](/填充.jpg)`
        }
    ])

    // 3. 上传的文件列表 (Wizard向导用)
    const uploadedFiles = ref([])

    // ================= 动作 (Actions) =================

    // 添加新报告
    function addReport(newReport) {
        reports.value.unshift(newReport)
    }

    // 更新报告
    function updateReport(id, data) {
        const report = reports.value.find(r => r.id === id)
        if (report) {
            Object.assign(report, data)
        }
    }

    // 添加新模板，支持指定所属大类名称
    function addTemplate(newTemplate, categoryName) {
        if (templates.value.length === 0) return

        // 优先根据传入的大类名称查找
        let targetCategory = null
        if (categoryName) {
            targetCategory = templates.value.find(cat => cat.name === categoryName) || null
        }

        // 找不到则退回到原来的行为：追加到最后一个分类中
        if (!targetCategory) {
            targetCategory = templates.value[templates.value.length - 1]
        }

        targetCategory.list.unshift(newTemplate)
    }

    // 更新模板
    function updateTemplate(id, data) {
        for (const category of templates.value) {
            const template = category.list.find(t => t.id === id)
            if (template) {
                Object.assign(template, data)
                return
            }
        }
    }

    // 删除报告
    function deleteReport(id) {
        reports.value = reports.value.filter(r => r.id !== id)
    }

    // 删除模板
    function deleteTemplate(templateId) {
        // 遍历分类查找并删除
        templates.value.forEach(category => {
            category.list = category.list.filter(t => t.id !== templateId)
        })
    }

    // 通过ID获取报告内容 (用于编辑器)
    function getReportById(id) {
        return reports.value.find(r => r.id === id)
    }

    return {
        templates,
        reports,
        uploadedFiles,
        addReport,
        updateReport,
        addTemplate,
        updateTemplate,
        deleteReport,
        deleteTemplate,
        getReportById
    }
})